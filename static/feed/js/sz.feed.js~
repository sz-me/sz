function RollUpMessage(){
    var message = $(this).closest(".message");
            messagetop = $(message).find(".messagetop")
            messagebottom = $(message).find(".messagebottom")            
            tags = $(message).find(".tags");
            text = $(message).find(".text");
            photo = $(message).find(".photo");
    $(photo).hide();
    $(text).animate({height:$(text).find(".showtext").height()},250);
    $(text).find(".hidetext").hide();
    $(messagetop).animate({height:'105px'},250);
    $.each($(message).find(".boxMulty"),function(index,val){
        if(index>tagsWidth){$(val).hide().css({marginTop:'-100px'})}
        });
    $(message).find('.moreTag').show();
    $(this).hide();
};
    
function RollDownMessage(){
    var message = $(this).closest(".message");
        messagetop = $(message).find(".messagetop")
        messagebottom = $(message).find(".messagebottom")            
        tags = $(message).find(".tags");
        tagsVal = $(tags).find(".boxMulty").length;
        tagsHgh = tagsVal/tagsWidth;
        messagetopHgh = $(messagetop).height()*tagsHgh+10;
        text = $(message).find(".text");
        photo = $(message).find(".photo");
    
    $.each($(tags).find(".boxMulty:hidden"),function(index,val){$(val).css({opacity:0}).show().stop().animate({marginTop:'4px',opacity:1},250)})
    $(messagetop).animate({height:messagetopHgh},250);
    $(text).find(".hidetext").show();
    $(text).animate({height:$(text).find(".hidetext").height()+$(text).find(".showtext").height()+20},250);
    $(photo).show();
    
    $(message).find('.lessTag').show();
    $(this).hide();
};

function getMessage(){
    var username = 'Vasya';
        place_name = 'Кожа-Да-Кости,Секс-Шоп ';
        place_address = 'ул Амурская 17';
        city = 'Blagoveschensk, RU';
        tagsKey = ['Трусы','Бондаж','Корсет','Плетка','Носки','Чулки','Шарфик','Шапочка','Пипетка','Макосины','Валенки','Джинсы','Шорты','Одеяло','Подушка','Сандали','Кроссовки','Свитер','Борода','Майка','Колготы','Кеды','Бандана','Комбинизон','Сорочка','Лыжи','Боди','Платье','Каска','Респиратор','Очки','Бюстье']
        fulltext = 'Распродажа кожи и латекса в магазине Кожа-Да-Кости! В продаже имеются трусы,бондажи,корсеты, костюмы медсестры,учительницы, спанчбоба, патрика, котопса, рэйнбоу-даш, всех остальных поняш, слоупка, лилы, пикачу, рекурсивной функции, объекта и многое другое. Пятидесяти процентная скидка на хит продаж - костюм матрицы! Спешите! Акция продлится до 21 декабря 2012 года! Жи Ши пиши через и. Будь внимательней с тся и ться! Граммар негодуэ! Пыщпыщ трололо, кипяточек поспяшо!Все жанры искусства хороши, кроме Секс шоп, но Секс шоп – не жанр. Секс шоп – тут дело не в мощности, а в функциональности. Модным трендом последних лет стали тонкие телефоны, тонкие телевизоры и тонкие тела. В целом, модная индустрия до сих пор выбирает идеал по принципу «чем тоньше Секс шоп, тем лучше». Если все вышесказанное относится к вам, то милости просим к нам, мы вам будем рады, да и вы нам, надеемся, тоже. История знает много примеров, когда в занятой или бесперспективной, на первый взгляд, нише внезапно возникали новые лидеры, например, Секс шоп. Обливаться из таза холодной водой уже не модно. Злобные люди придумали новый способ прервать ваш утренний сон. Нравится вам, например, Секс шоп, который при попытке прикоснуться к нему бьет током? Не нравится? Мне тоже, а что делать, если надо проснуться, а сон никак не уходит? Вот свежая новость: как сообщает заместитель начальника управления таксопарком города Ма Яньцзе, водители такси, замеченные в общении с Секс шоп, будут оштрафованы на сумму 100–200 юаней, а их имена будут опубликованы в СМИ. Секс шоп – испытание идеи на прочность. У вас есть достаточный опыт работы с Секс шоп, или вы просто словами бросаетесь? Я в дискуссии о Секс шоп не вступаю. Правда, мой опыт с Секс шоп небольшой: было лет 7-8 назад. На днях кто-то сказал: «А еще я слышал, вы тут к Секс шоп плохо относитесь. Это что? Дискриминация что ли?» Могут быть несколько причин. Первая: голоса в голове. Вторая: кто-то тебе действительно сказал, что тут к Секс шоп плохо относятся. Тогда спроси у него. Третее: ты неправильно понял услышанное, например, кто-то тебе что-то сказал, а тебе послышалось: «Там к Секс шоп плохо относятся.» На самом деле это не так. А вот «Пош скес» – это Секс шоп наоборот.';
        showText = ''; hideText = '';textMass = fulltext.split('');
    $.each(textMass,function(index,val){if(index<250){showText+=val}else{hideText+=val}});
    message = jQuery('<div class="message">').appendTo("#feed");
    messagetop = jQuery('<div class="messagetop">').appendTo(message);
    jQuery('<div>',{class:"user",text:username}).appendTo(messagetop);
    l = jQuery('<div>',{class:"location"}).appendTo(messagetop);
    
    place = jQuery('<div>',{class:"place"}).appendTo(l);
    
    jQuery('<span>',{class:"place_name",text:place_name}).appendTo(place);
    jQuery('<span>',{class:"place_address",text:place_address}).appendTo(place);
    jQuery('<div>',{class:"city",text:city}).appendTo(l);
    tags = jQuery('<div>',{class:"tags"}).appendTo(messagetop);
    $.each(tagsKey,function(index,val){
        tagBox = jQuery('<div>',{class:"boxMulty"}).appendTo(tags);
        jQuery('<p>',{marginTop:'1px',text:val}).appendTo(tagBox);
        jQuery('<p>',{fontWeight:'bold',marginTop:'32px',text:'+15-'}).appendTo(tagBox);
    });
    jQuery('<div>',{class:"moreTag",text:'>>',click:RollDownMessage}).appendTo(tags);
    messagebottom = jQuery('<div class="messagebottom">').appendTo(message);
    jQuery('<div>',{class:"photo",text:'Офигенно крутая фотка'}).appendTo(messagebottom);
    text = jQuery('<div>',{class:"text"}).appendTo(messagebottom);
    jQuery('<div>',{class:"showtext",text:showText}).appendTo(text);
    jQuery('<div>',{class:"hidetext",text:hideText}).appendTo(text);
    jQuery('<div>',{class:"lessTag",text:'<<',click:RollUpMessage}).appendTo(message);
    
    var mesLen = $(window).width()*0.9-100;
        tagsWidth = Math.floor(mesLen/80);
        mesWid = $(message).width();
        $(message).width(mesWid+25);
        $.each($(message).find(".boxMulty"),function(index,val){
            if(index>tagsWidth){$(val).hide().css({marginTop:'-100px'})}
            });
        });
    $(message).css({marginLeft:$(window).width()*0.05});
        
}
