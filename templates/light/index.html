{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="utf-8" />
    <title>SZ Light</title>
    <link href="{% static 'bootstrap/css/bootstrap.css' %}" rel="stylesheet">
    <style>
        body {
            padding-top: 60px; /* 60px to make the container go all the way to the bottom of the topbar */
        }
    </style>
    <link href="{% static 'bootstrap/css/bootstrap-responsive.css' %}" rel="stylesheet">

    <script src="http://code.jquery.com/jquery-1.8.2.js"></script>
    <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
    <script type="text/javascript" src={% static "bootstrap/js/bootstrap.js" %}></script>
    <script type="text/javascript" src={% static "feed/js/sz.api.js" %}></script>
    <script type="text/javascript" src={% static "light/js/sz.light.js" %}></script>
    <script type="text/javascript">
        var lightController = null;

        function detectTyping()
        {
            lightController.detectControlTextChange(lightController);
        }
        function initializeController(controller){
            if (navigator.geolocation)
            {
                navigator.geolocation.getCurrentPosition(function(data) {

                    var latitude = data.coords.latitude;
                    var longitude = data.coords.longitude;
                    var position = {
                        longitude: longitude,
                        latitude: latitude
                    };
                    controller.position = position;
                    controller.feedAction();
                });
                setInterval('detectTyping()', 3000);
            }
            else
                alert("Geolocation services are not supported by your browser " +
                        "or you do not have a GPS device in your computer.");
        }

        $(document).ready(function () {
            var api = new sz.Api({uri: '..',request_func: $.ajax});
            lightController = new sz.light.Controller(api, $('#feed'), $('#control'));
            initializeController(lightController);

        });

        function queryOnKeyPressHandler(obj, e){
            var keycode = null;
            if (window.event) keycode = window.event.keyCode;
            else if (e)
                keycode = e.which;
            else return;
            if (keycode == 13)
            {
                refreshFeed();
            }
        }


    </script>

</head>
<body style="/*max-width:640px;*/">
    {% csrf_token %}
    <input id="auth_login_url" type="hidden" value="{% url auth_login %}?next={% url light-index %}"/>
    <header class="navbar navbar-fixed-top" style="/*height:18px; background: url({% static "light/img/logo.png" %}) no-repeat left bottom;text-align: right;*/">

        <div class="navbar-inner">
            <div class="container">
                <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </a>
                <a class="brand" href="#">SZ Light</a>
                <ul class="nav pull-right">
                    {% if user.is_authenticated %}
                        <li class="dropdown ">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                @{{ user }}
                                <b class="caret"></b>
                            </a>
                            <ul class="dropdown-menu ">
                                <li><a href="{% url auth_logout %}?next={% url light-index %}">log out</a></li>
                            </ul>
                        </li>

                    {% else %}
                        <li><a href="{% url auth_login %}?next={% url light-index %}">log in</a></li> {% endif %}
                </ul>
                <div class="nav-collapse collapse">
                    <section id="control" class="form-search navbar-search pull-left"></section>

                </div>

            </div>
        </div>
    </header>

    <section id="feed-section" class="container">
        <article id="map_canvas" style="width:100%; height:120px; background-color:white;"></article>
        <article id="feed" class="span12"></article>
    </section>
    <!--
    <footer >
        <hr/>
        <section id="control" class="form-search">
        </section>
    </footer>
    -->
</body>
</html>