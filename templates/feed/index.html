<!DOCTYPE html>
<html>
 <head>
  <title>ShZH</title>
  <meta charset="utf-8" />
   <link rel="stylesheet" href="http://code.jquery.com/ui/1.9.0/themes/base/jquery-ui.css" />
     <script src="http://code.jquery.com/jquery-1.8.2.js"></script>
    <script src="http://code.jquery.com/ui/1.9.0/jquery-ui.js"></script>

    
    <script type="text/javascript" src="{{ STATIC_URL }}js/sz.feed.js"></script>
    <script type="text/javascript" src="../../static/feed/js/sz.feed.js"></script>
    
        <script type="text/javascript" src="{{ STATIC_URL }}js/sz.menu.js"></script>
    <script type="text/javascript" src="../../static/feed/js/sz.menu.js"></script>
    
    <script type="text/javascript" src="{{ STATIC_URL }}js/sz.api.js"></script>
    <script type="text/javascript" src="../../static/feed/js/sz.api.js"></script>
    
    <link rel="stylesheet" href="{{ STATIC_URL }}css/styles.css">
    <link rel="stylesheet" href="../../static/feed/css/styles.css">

    <link rel="stylesheet" href="{{ STATIC_URL }}css/feed.css">
    <link rel="stylesheet" href="../../static/feed/css/feed.css">    
    
    <link rel="stylesheet" href="{{ STATIC_URL }}css/geo.css">
    <link rel="stylesheet" href="../../static/feed/css/geo.css">
    
    <link rel="stylesheet" href="{{ STATIC_URL }}css/tags.css">
    <link rel="stylesheet" href="../../static/feed/css/tags.css">
    

 </head>
 <body>
 {% csrf_token %}
<!-- Основное меню -->
    <div id='mainmenu'>
    <div id='top'></div>
        <div id='menu'>
         
            <div id='myuser'>
                <img src="../../static/feed/img/jack.gif" width="70" height="70" id='myface' alight='top' alt='myuserpic'>
<!--                 <div id='myname'></div> -->
          <!--      <div id='buybuy'>Logout</div>-->
            </div>
            <div id='category'>
            
                <div id='city'><a id='cityClose' class='close'></a> <a class='cityValue'>Город</a></div>
                <div id='place'><a id='placeClose' class='close'></a><a class='placeValue'>Магазин</a></div>
                <div id='tags'><a id='tagsClose' class='close'></a><a class='tagsValue'>Тэги</a></div>
<!--                 <div id='message'><a id='messageValue' >Сообщение</a></div> -->
            </div>
            <div id='tagsTopArea'></div>
        </div>        
        <div id='sepString'></div>
        <div id='area'>
            <div id='cityArea' >
                <input type="input" class="searchString"/>
                
            </div>
            <div id='placeArea' >
                <div id='placeSearch'>
                    <input type="checkbox" id="closerCheck"/> <label for="closerCheck">Ближайшие</label>
                    <input type="input" class="searchString"/>
                </div>
                <div id='lessPlace'></div>
                <div id='placeTag'>
                </div>
                <div id='morePlace'></div>
            </div>
            <div id='tagsArea' >                
                <div id='tagSearch'>
                    <input type="radio" value="0" name='sort' id="popularTagSort" checked="checked"/><label for="popularTagSort">По популярности</label>
                    <input type="radio" value="1" name='sort' id="abcTagSort"/> <label for="abcTagSort">По алфавиту</label>
                    <input type="input" class="searchString"/>    
                </div>
                <div style='padding-top:10px;'>
                    <div id='lessTags'></div>
                    <div id='dollyPlace'>
                        <div class='dollyHead'></div>
                        <div class='dollyBody'></div>
                        <div class='dollyLegs'></div>
                        <div class='dollyFoot'></div>
                    </div>
                
                    
                    <div id='tagsPlace'>
                        <div id='dollyPopularPlace' class='dollyPlace'></div>
                        <div id='dollyHeadPlace' class='dollyPlace'></div>
                        <div id='dollyBodyPlace' class='dollyPlace'></div>
                        <div id='dollyLegsPlace' class='dollyPlace'></div>
                        <div id='dollyFootPlace' class='dollyPlace'></div>
                    </div>
                    <div id='moreTags'></div>
               
                <div id='gender'>
                    <div id='nosex'></div>
                    <div id='female'></div>
                    <div id='male'></div>
                    <div id='kind'></div>
                </div>
                </div>
            </div>
            <!--<div id='messageArea'>
                <form action="handler.php">
                <span class='addMessage' id='textMessage'>Создать сообщение</span>
                </form>
            </div>-->
        </div>
    </div> 

    <div id='feed'>
        <div id='newmessageBox'>
            <div id='newmessage_locationValue'>
                <div id='newmessage_placeValue'>Все мои детальки, роботический магазин</div>
                <div id='newmessage_cityValue'>Благовещенск</div>
            </div>
            <div id='newmessage_tagsValue'></div>
            <textarea id='newmessage_textValue' rows='1' autocomplete="off">Расскажи мне о ништяках
            </textarea>
            <div style='padding:2em'>
                <span class='addMessage' id='newmessage_textAdd'>Готово!</span>
            </div>
            
        </div>
    </div>

           
    
<script type="text/javascript">



$(document).ready(function () {
   $(".placeValue").text('a');
     getMessage()
    $("#area").children().hide();
    var api = new sz.Api({uri: 'api/',request_func: $.ajax});
        
    function cityView(data)
    {if (data.response.length == 1){var $value = data.response[0]; $(".cityValue").text($value.name).attr('id',$value.geoname_id)}}

    navigator.geolocation.getCurrentPosition(function(data) {
        var latitude = data['coords']['latitude'];
        var longitude = data['coords']['longitude'];
        var accuracy = data['coords']['accuracy'];
        api.get('cities',
            {latitude: latitude,longitude: longitude},
            function(r){ cityView(r);});
        });
    topAreaWidth();  
    $("#category").css({
        left:$(window).width()/2-$("#category").width()
        });
    
    
    $(".placeValue").click(placeClick);    
    $("#placeClose").click(function(){
        $(".addMessage").attr('class','NoaddMessage')
        $(".placeValue").text('Магазин');
        $(".placeValue").removeAttr('id');
        topAreaWidth();
        $(this).text('');
        });
    $("#morePlace").click(morePlace);
    $("#lessPlace").click(lessPlace);
    
    $("#tagsClose").click(tagsCloseClick);
    $(".tagsValue").click(tagsClick)
    $("#moreTags").click(moreTags);
    $("#lessTags").click(lessTags);
    
    $(".dollyBody").click(dollyBodyClick);
    
    $("#newmessage_textValue")
    .data('originalText', $("textarea").text())
    .css('color', '#999')
    .focus(function() {
    var $el = $(this);
    rollUpAllArea()
    if (this.value == $el.data('originalText')) {
        this.value = '';
        $(this).attr('rows','4').css({color:'black',borderColor:'orange'});
        jQuery($(this)).autoResize();
        
        $("#newmessage_locationValue").show();
        $("#newmessage_tagsValue").show()
        $("#newmessage_textAdd").show()
        }
    })
    .blur(function() {
        var tagLen = $("#newmessage_tagsValue").children().length
        $(".user").text(tagLen)
        if (this.value == ''&&tagLen==0) {
            this.value = $(this).data('originalText');
            $(this).attr('rows','1').css({color: '#999',borderColor:'green'});
            $("#newmessage_locationValue").hide();
            $("#newmessage_tagsValue").hide()
            $("#newmessage_textAdd").hide()
        }
    });
    //var api = new sz.Api({uri: 'api/',request_func: $.ajax});
    $("#newmessage_textAdd").click(function(){   
            var fulltext = $("#newmessage_textValue").value
            api.post('messages/',{"text": fulltext,
                "latitude": 50.261957910406444,
                "longitude": 127.53488266715124,
                "accuracy": 10.0,
                "city_id": 2026609,
                "place_id": "4c636f6f79d1e21e62cbd815",
                "bargain_date": null,
                "csrfmiddlewaretoken": $('input[name="csrfmiddlewaretoken"]').val()
            $(this).css({backgroundColor:'orange'})
    });
    
    })
    
});

</script>

 </body>
</html>
